name: Coverage

on:
  workflow_call:
    secrets:
      codecov-secret:
        description: 'Codecov token for repository'
        required: false

jobs:
  test:
    name: coverage
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: julia-actions/setup-julia@latest

      # ğŸ§° Cache des artefacts Julia (binaries tÃ©lÃ©chargÃ©s)
      - name: Cache Julia artifacts
        uses: actions/cache@v4
        with:
          path: ~/.julia/artifacts
          key: ${{ runner.os }}-julia-artifacts-${{ hashFiles('**/Manifest.toml') }}
          restore-keys: |
            ${{ runner.os }}-julia-artifacts-

      # âš¡ Cache du code prÃ©compilÃ© (.ji)
      - name: Cache Julia compiled code
        uses: actions/cache@v4
        with:
          path: ~/.julia/compiled
          key: ${{ runner.os }}-julia-compiled-${{ hashFiles('**/Manifest.toml') }}
          restore-keys: |
            ${{ runner.os }}-julia-compiled-

      # ğŸ§± ExÃ©cuter les tests
      - uses: julia-actions/julia-runtest@latest

      # ğŸ“Š GÃ©nÃ©rer les fichiers de couverture
      - uses: julia-actions/julia-processcoverage@latest

      # â˜ï¸ Envoyer les rÃ©sultats Ã  Codecov
      - uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.codecov-secret }}
